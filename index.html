<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1a472a" id="themeColorMeta">
  <meta name="description" content="Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ… â€” ØªÙ„Ø§ÙˆØ§Øª Ù…ØªÙ†ÙˆØ¹Ø©ØŒ ØªÙØ³ÙŠØ±ØŒ ØªØ±Ø¬Ù…Ø©ØŒ ØªØµÙØ­ Ø§Ù„Ù…ØµØ­Ù">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…">
  <link rel="manifest" href="manifest.json">
  <title>Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€ Design Tokens â”€â”€ */
    :root {
      --gold:#c9a84c; --gold-l:#e8c97e; --gold-d:#8b6914; --gold-glow:rgba(201,168,76,.25);
      --bg:#f5f0e8; --surface:#fff; --surface2:#f9f5ef; --hdr:#1a472a; --nav:#0d2b18;
      --mushaf:#fdf6e3; --mushaf2:#f0e6cc; --border:rgba(201,168,76,.22);
      --txt:#1c1208; --txt2:#4a3728; --muted:#8a7560; --heading:#1a472a;
      --hover:rgba(201,168,76,.16); --playing:rgba(201,168,76,.32);
      --shadow:0 4px 24px rgba(0,0,0,.07); --shadow-lg:0 8px 40px rgba(0,0,0,.13);
      --inp:#fff; --inp-b:#d4c4a8; --popup:#fff;
      --bar:linear-gradient(135deg,#1a472a,#0d2b18); --tr:.35s cubic-bezier(.4,0,.2,1);
      --fs:1.65rem; --lh:3;
    }
    [data-theme=dark]{
      --bg:#0e1a14; --surface:#152210; --surface2:#1c2e18; --hdr:#0a160d; --nav:#06100a;
      --mushaf:#1a2a1e; --mushaf2:#12201a; --border:rgba(201,168,76,.16);
      --txt:#e8dcc8; --txt2:#c4b49a; --muted:#7a9070; --heading:#c9a84c;
      --hover:rgba(201,168,76,.1); --playing:rgba(201,168,76,.22);
      --shadow:0 4px 24px rgba(0,0,0,.4); --shadow-lg:0 8px 40px rgba(0,0,0,.6);
      --inp:#1c2e18; --inp-b:#3a5a30; --popup:#1a2a1e;
      --bar:linear-gradient(135deg,#0a160d,#06100a);
    }
    [data-theme=sepia]{
      --bg:#f4e8d0; --surface:#fdf6e3; --surface2:#f5ead0; --hdr:#5c3a1e; --nav:#3d2512;
      --mushaf:#fdf6e3; --mushaf2:#f0e6cc; --border:rgba(139,105,20,.28);
      --txt:#2c1a0e; --txt2:#5c3a1e; --muted:#8b6940; --heading:#5c3a1e;
      --hover:rgba(139,105,20,.13); --playing:rgba(139,105,20,.27);
      --inp:#fdf6e3; --inp-b:#c4a870; --popup:#fdf6e3;
      --bar:linear-gradient(135deg,#5c3a1e,#3d2512);
    }

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;transition:background var(--tr),color var(--tr)}
    ::-webkit-scrollbar{width:6px} ::-webkit-scrollbar-track{background:transparent} ::-webkit-scrollbar-thumb{background:var(--gold-d);border-radius:3px}

    /* Header */
    .hdr{background:var(--hdr);border-bottom:2px solid var(--gold);position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,.4);transition:background var(--tr)}
    .hdr-in{max-width:1200px;margin:0 auto;padding:10px 18px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .logo{display:flex;align-items:center;gap:11px}
    .logo-icon{width:42px;height:42px;background:linear-gradient(135deg,var(--gold),var(--gold-d));border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:19px;color:#0d2b18;box-shadow:0 4px 12px var(--gold-glow)}
    .logo h1{font-size:1.25rem;font-weight:800;color:var(--gold-l);text-shadow:0 2px 8px rgba(0,0,0,.3)}
    .logo p{font-size:.68rem;color:rgba(255,255,255,.48);margin-top:1px}
    .hdr-actions{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
    .hdr-stats{display:flex;gap:14px;align-items:center;background:rgba(255,255,255,.06);border:1px solid rgba(201,168,76,.18);padding:7px 14px;border-radius:11px}
    .stat .num{font-size:.95rem;font-weight:700;color:var(--gold-l)} .stat .lbl{font-size:.58rem;color:rgba(255,255,255,.42)} .sdiv{width:1px;height:22px;background:rgba(201,168,76,.22)}
    .theme-pill{display:flex;align-items:center;background:rgba(255,255,255,.07);border:1px solid rgba(201,168,76,.28);border-radius:40px;padding:3px;gap:2px}
    .th-opt{width:30px;height:30px;border-radius:50%;border:none;background:transparent;color:rgba(255,255,255,.42);font-size:13px;cursor:pointer;transition:all .22s;display:flex;align-items:center;justify-content:center}
    .th-opt.on{background:var(--gold);color:#0d2b18;box-shadow:0 2px 8px var(--gold-glow)}
    .font-row{display:flex;align-items:center;gap:5px;background:rgba(255,255,255,.05);border:1px solid rgba(201,168,76,.18);padding:4px 9px;border-radius:9px}
    .f-btn{width:26px;height:26px;border-radius:6px;border:1px solid rgba(201,168,76,.22);background:rgba(255,255,255,.04);color:var(--gold-l);font-size:12px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;font-family:'Tajawal',sans-serif}
    .f-btn:hover{background:var(--gold);color:#0d2b18}
    .ico-btn{width:34px;height:34px;border-radius:9px;border:1px solid rgba(201,168,76,.26);background:rgba(255,255,255,.05);color:var(--gold-l);font-size:14px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;position:relative}
    .ico-btn:hover{background:var(--gold);color:#0d2b18}
    .badge{position:absolute;top:-3px;right:-3px;width:11px;height:11px;background:#ef4444;border-radius:50%;border:2px solid var(--hdr);display:none} .badge.on{display:block}

    /* Nav */
    .nav{background:var(--nav);border-bottom:1px solid rgba(201,168,76,.13);transition:background var(--tr)}
    .nav-in{max-width:1200px;margin:0 auto;padding:0 18px;display:flex;overflow-x:auto}
    .tab{padding:12px 20px;font-size:.875rem;font-weight:600;color:rgba(255,255,255,.44);border:none;background:transparent;cursor:pointer;border-bottom:3px solid transparent;transition:all .22s;font-family:'Tajawal',sans-serif;display:flex;align-items:center;gap:6px;white-space:nowrap}
    .tab:hover{color:var(--gold-l)} .tab.on{color:var(--gold-l);border-bottom-color:var(--gold);background:rgba(201,168,76,.07)}

    /* Main */
    .main{max-width:1200px;margin:0 auto;padding:18px 14px}
    .panel{display:none} .panel.on{display:block}

    /* Cards */
    .card{background:var(--surface);border-radius:17px;border:1px solid var(--border);box-shadow:var(--shadow);transition:background var(--tr),border-color var(--tr)}
    .inp{width:100%;padding:10px 13px;border:2px solid var(--inp-b);border-radius:10px;font-size:.88rem;font-family:'Tajawal',sans-serif;outline:none;transition:all .22s;background:var(--inp);color:var(--txt)}
    .inp:focus{border-color:#2d6a4f;box-shadow:0 0 0 3px rgba(45,106,79,.13)}
    .lbl{display:block;font-weight:600;color:var(--txt2);margin-bottom:6px;font-size:.83rem}
    .btn-p{background:linear-gradient(135deg,#2d6a4f,#1a472a);color:#fff;border:none;padding:12px 32px;border-radius:11px;font-size:.92rem;font-weight:700;font-family:'Tajawal',sans-serif;cursor:pointer;transition:all .22s;box-shadow:0 4px 16px rgba(26,71,42,.28);display:inline-flex;align-items:center;gap:7px}
    .btn-p:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(26,71,42,.38)}

    /* AoD Banner */
    .aod{background:linear-gradient(135deg,var(--hdr) 0%,#0d3520 100%);border:1px solid var(--gold);border-radius:17px;padding:22px 26px;margin-bottom:18px;position:relative;overflow:hidden}
    .aod::before{content:'ï·½';position:absolute;top:-18px;left:-8px;font-family:'Amiri',serif;font-size:7rem;color:rgba(201,168,76,.04);pointer-events:none}
    .aod-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px}
    .aod-badge{display:flex;align-items:center;gap:7px;background:var(--gold);color:#0d2b18;padding:5px 13px;border-radius:18px;font-weight:800;font-size:.8rem}
    .aod-text{font-family:'Amiri Quran','Amiri',serif;font-size:1.65rem;line-height:2.8;color:var(--gold-l);text-align:center;margin-bottom:10px}
    .aod-ref{text-align:center;font-size:.82rem;color:rgba(255,255,255,.5)}
    .aod-acts{display:flex;gap:7px;margin-top:12px;flex-wrap:wrap}
    .aod-btn{padding:7px 14px;border-radius:9px;border:none;font-family:'Tajawal',sans-serif;font-size:.79rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px}

    /* Mushaf */
    .mushaf{background:var(--mushaf);border-radius:4px;padding:42px 50px;
      box-shadow:0 0 0 1px var(--gold-d),0 0 0 5px var(--mushaf2),0 0 0 7px var(--gold),0 6px 48px rgba(0,0,0,.32),inset 0 0 60px rgba(201,168,76,.04);
      position:relative;min-height:740px;display:flex;flex-direction:column;transition:background var(--tr);width:100%;max-width:880px}
    .mushaf::before,.mushaf::after{content:'';position:absolute;width:34px;height:34px;border:2px solid var(--gold)}
    .mushaf::before{top:9px;right:9px;border-left:none;border-bottom:none} .mushaf::after{bottom:9px;left:9px;border-right:none;border-top:none}
    .pg-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:11px;border-bottom:1px solid rgba(201,168,76,.22)}
    .pg-hdr span{font-family:'Amiri',serif;color:var(--gold-d);font-size:.92rem}
    .basmala{font-family:'Amiri Quran','Amiri',serif;font-size:1.65rem;color:var(--gold-d);text-align:center;margin:10px 0 16px}
    .surah-sep{text-align:center;margin:14px 0;padding:9px 26px;background:linear-gradient(135deg,rgba(201,168,76,.09),rgba(201,168,76,.03));border:1px solid rgba(201,168,76,.32);border-radius:5px;position:relative}
    .surah-sep::before{content:'â‹';position:absolute;right:8px;top:50%;transform:translateY(-50%);color:var(--gold);font-size:12px} .surah-sep::after{content:'â‹';position:absolute;left:8px;top:50%;transform:translateY(-50%);color:var(--gold);font-size:12px}
    .sep-name{font-family:'Amiri',serif;font-size:1.28rem;color:var(--heading);font-weight:700} .sep-info{font-size:.74rem;color:var(--muted);margin-top:2px}
    .ayahs{flex:1;font-family:'Amiri Quran','Amiri',serif;font-size:var(--fs);line-height:var(--lh);color:var(--txt);text-align:justify;direction:rtl;transition:font-size var(--tr),color var(--tr)}
    .av{display:inline;cursor:pointer;border-radius:4px;padding:0 2px;transition:background .18s}
    .av:hover{background:var(--hover)} .av.pl{background:var(--playing);color:var(--gold-d)}
    .an{font-size:1.05rem;color:var(--gold-d);margin:0 3px;vertical-align:middle;cursor:default}
    .pg-ftr{text-align:center;margin-top:16px;padding-top:9px;border-top:1px solid rgba(201,168,76,.22)}
    .pg-ftr span{font-family:'Amiri',serif;font-size:.82rem;color:var(--gold-d)}
    .pg-load{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:500px;gap:14px}
    .spinner{width:44px;height:44px;border:3px solid rgba(201,168,76,.2);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite}
    .load-txt{font-family:'Amiri',serif;font-size:1rem;color:var(--gold-d)}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Page Controls */
    .pg-ctrl{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:11px 16px;display:flex;align-items:center;gap:9px;flex-wrap:wrap;justify-content:center;box-shadow:var(--shadow);width:100%;max-width:880px;transition:background var(--tr)}
    .pnav{width:38px;height:38px;border-radius:8px;border:1px solid var(--inp-b);background:var(--inp);color:var(--heading);cursor:pointer;font-size:14px;transition:all .2s;display:flex;align-items:center;justify-content:center}
    .pnav:hover:not(:disabled){background:#1a472a;color:#fff;border-color:#1a472a} .pnav:disabled{opacity:.3;cursor:not-allowed}
    .pg-grp{display:flex;align-items:center;gap:6px;background:var(--surface2);border-radius:9px;padding:6px 12px;border:1px solid var(--inp-b)}
    .pg-grp label{font-size:.78rem;color:var(--muted);font-weight:600;white-space:nowrap}
    .pg-inp{width:52px;padding:3px 6px;border:1px solid var(--inp-b);border-radius:6px;font-size:.95rem;font-weight:700;color:var(--heading);text-align:center;font-family:'Tajawal',sans-serif;outline:none;background:var(--inp)}
    .pg-tot{font-size:.78rem;color:var(--muted)}
    .ctrl-sel{padding:6px 10px;border:1px solid var(--inp-b);border-radius:8px;font-family:'Tajawal',sans-serif;font-size:.8rem;color:var(--txt);background:var(--inp);cursor:pointer;outline:none}

    /* Popup */
    .popup{position:fixed;bottom:74px;left:50%;transform:translateX(-50%) translateY(14px);background:var(--popup);border-radius:17px;padding:16px 20px;box-shadow:var(--shadow-lg);max-width:560px;width:92%;z-index:200;opacity:0;pointer-events:none;transition:all .3s cubic-bezier(.34,1.56,.64,1);border-top:4px solid var(--gold);border:1px solid var(--border)}
    .popup.on{opacity:1;pointer-events:auto;transform:translateX(-50%) translateY(0)}
    .popup-close{position:absolute;top:10px;left:10px;width:25px;height:25px;border-radius:50%;border:none;background:var(--surface2);cursor:pointer;font-size:11px;color:var(--muted);display:flex;align-items:center;justify-content:center}
    .pop-ref{font-size:.78rem;color:var(--gold-d);font-weight:700;margin-bottom:7px}
    .pop-txt{font-family:'Amiri Quran','Amiri',serif;font-size:1.32rem;line-height:2.4;color:var(--txt);margin-bottom:9px}
    .pop-taf{font-size:.83rem;color:var(--txt2);line-height:1.7;border-top:1px solid var(--border);padding-top:7px;margin-bottom:9px}
    .pop-acts{display:flex;gap:6px;flex-wrap:wrap}
    .pop-btn{padding:6px 12px;border-radius:7px;border:none;font-family:'Tajawal',sans-serif;font-size:.78rem;font-weight:600;cursor:pointer;transition:all .18s;display:flex;align-items:center;gap:5px}

    /* Mini player */
    .bar{position:fixed;bottom:0;left:0;right:0;background:var(--bar);border-top:2px solid var(--gold);padding:9px 18px;display:flex;align-items:center;gap:12px;z-index:150;transform:translateY(100%);transition:transform .32s cubic-bezier(.34,1.56,.64,1);flex-wrap:wrap}
    .bar.on{transform:translateY(0)}
    .b-info{flex:1;min-width:140px} .b-ref{font-size:.82rem;color:var(--gold-l);font-weight:700} .b-rec{font-size:.7rem;color:rgba(255,255,255,.42)}
    .b-ctrl{display:flex;align-items:center;gap:9px}
    .ab{width:34px;height:34px;border-radius:50%;border:none;background:rgba(201,168,76,.14);color:var(--gold-l);font-size:12px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
    .ab.main{width:42px;height:42px;background:var(--gold);color:#0d2b18;font-size:14px}
    .ab:hover{transform:scale(1.09)}
    .prog-area{flex:2;min-width:130px}
    .prog-bar{width:100%;height:4px;background:rgba(255,255,255,.1);border-radius:4px;cursor:pointer;overflow:hidden}
    .prog-fill{height:100%;background:var(--gold);border-radius:4px;width:0%;transition:width .28s}
    .t-row{display:flex;justify-content:space-between;font-size:.66rem;color:rgba(255,255,255,.33);margin-top:2px}
    .close-bar{background:none;border:none;color:rgba(255,255,255,.32);cursor:pointer;font-size:16px;transition:color .2s;padding:3px}
    .close-bar:hover{color:rgba(255,255,255,.72)}

    /* â”€â”€ Notification Panel â”€â”€ */
    .notif-ov{position:fixed;inset:0;background:rgba(0,0,0,.38);z-index:299;opacity:0;pointer-events:none;transition:opacity .28s;backdrop-filter:blur(2px)}
    .notif-ov.on{opacity:1;pointer-events:auto}
    .notif-panel{position:fixed;top:78px;left:50%;transform:translateX(-50%) scale(.95);background:var(--popup);border-radius:17px;padding:22px;box-shadow:var(--shadow-lg);max-width:420px;width:92%;z-index:300;opacity:0;pointer-events:none;transition:all .28s cubic-bezier(.34,1.56,.64,1);border:1px solid var(--border)}
    .notif-panel.on{opacity:1;pointer-events:auto;transform:translateX(-50%) scale(1)}
    .notif-title{font-size:1.05rem;font-weight:800;color:var(--heading);margin-bottom:15px;display:flex;align-items:center;gap:7px}
    .time-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:14px}
    .t-opt{padding:9px 7px;border-radius:9px;border:2px solid var(--border);background:var(--surface2);color:var(--txt2);font-family:'Tajawal',sans-serif;font-size:.78rem;font-weight:600;cursor:pointer;transition:all .18s;text-align:center}
    .t-opt:hover{border-color:var(--gold);color:var(--gold-d)} .t-opt.on{border-color:var(--gold);background:rgba(201,168,76,.1);color:var(--gold-d)}
    .notif-en-btn{width:100%;padding:12px;border:none;border-radius:11px;background:linear-gradient(135deg,#1a472a,#2d6a4f);color:#fff;font-family:'Tajawal',sans-serif;font-size:.92rem;font-weight:700;cursor:pointer;transition:all .22s;margin-top:5px;display:flex;align-items:center;justify-content:center;gap:7px}
    .notif-en-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(26,71,42,.38)}
    .notif-st{margin-top:10px;padding:9px 13px;border-radius:9px;font-size:.82rem;text-align:center;display:none}
    .notif-st.ok{background:rgba(34,197,94,.09);color:#16a34a;border:1px solid rgba(34,197,94,.18);display:block}
    .notif-st.no{background:rgba(239,68,68,.09);color:#dc2626;border:1px solid rgba(239,68,68,.18);display:block}

    /* Toast */
    .toast{position:fixed;top:16px;left:50%;transform:translateX(-50%) translateY(-65px);background:var(--popup);padding:10px 20px;border-radius:10px;box-shadow:var(--shadow-lg);font-size:.86rem;font-weight:600;display:flex;align-items:center;gap:8px;z-index:999;transition:transform .28s cubic-bezier(.34,1.56,.64,1);border:1px solid var(--border);color:var(--txt)}
    .toast.on{transform:translateX(-50%) translateY(0)}

    /* Install banner */
    .install-ban{background:linear-gradient(135deg,#1a472a,#2d6a4f);border-radius:13px;padding:14px 18px;display:none;align-items:center;gap:12px;margin-bottom:15px;border:1px solid var(--gold)}
    .install-ban.on{display:flex}
    .install-txt strong{display:block;color:var(--gold-l);font-size:.92rem} .install-txt span{font-size:.78rem;color:rgba(255,255,255,.52)}
    .install-go{padding:8px 16px;background:var(--gold);color:#0d2b18;border:none;border-radius:8px;font-family:'Tajawal',sans-serif;font-weight:700;font-size:.82rem;cursor:pointer;transition:all .2s;white-space:nowrap}
    .install-go:hover{transform:scale(1.04)}
    .install-x{color:rgba(255,255,255,.38);background:none;border:none;font-size:17px;cursor:pointer}

    /* Reading mode */
    body.read .hdr,body.read .nav,body.read .pg-ctrl,body.read .install-ban{display:none!important}
    body.read .main{padding:0}
    .read-exit{position:fixed;top:12px;right:12px;z-index:500;background:var(--gold);color:#0d2b18;border:none;border-radius:9px;padding:8px 14px;font-family:'Tajawal',sans-serif;font-weight:700;font-size:.82rem;cursor:pointer;box-shadow:0 4px 16px rgba(0,0,0,.28);display:none;align-items:center;gap:5px}
    body.read .read-exit{display:flex}

    /* Tajweed tooltip */
    .tj-word{cursor:help;border-radius:3px;padding:0 1px;transition:opacity .15s;}
    .tj-word:hover{opacity:.75;}

    @media(max-width:768px){.mushaf{padding:22px 14px} .ayahs{font-size:1.38rem;line-height:2.8} .hdr-stats{display:none} .font-row{display:none}}
    @media(max-width:480px){.mushaf{padding:16px 11px} .ayahs{font-size:1.22rem} .hdr-in{padding:8px 11px}}

    body,.card,.mushaf,.popup,.bar,.notif-panel,.pg-ctrl,.inp,.ctrl-sel{transition:background var(--tr),color var(--tr),border-color var(--tr),box-shadow var(--tr)}
  </style>
</head>
<body data-theme="light">

<button class="read-exit" onclick="exitRead()"><i class="fas fa-compress"></i> Ø®Ø±ÙˆØ¬</button>

<!-- HEADER -->
<header class="hdr">
  <div class="hdr-in">
    <div class="logo">
      <div class="logo-icon"><i class="fas fa-book-quran"></i></div>
      <div><h1>Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…</h1><p>Ø§Ø³ØªÙ…Ø¹ ÙˆØªØ¯Ø¨Ø± Ù…Ø¹ ØªÙ„Ø§ÙˆØ§Øª Ù…ØªÙ†ÙˆØ¹Ø©</p></div>
    </div>
    <div class="hdr-actions">
      <div class="hdr-stats">
        <div class="stat"><div class="num">Ù¡Ù¡Ù¤</div><div class="lbl">Ø³ÙˆØ±Ø©</div></div>
        <div class="sdiv"></div>
        <div class="stat"><div class="num">Ù¦Ù¢Ù£Ù¦</div><div class="lbl">Ø¢ÙŠØ©</div></div>
        <div class="sdiv"></div>
        <div class="stat"><div class="num">Ù£Ù </div><div class="lbl">Ø¬Ø²Ø¡</div></div>
      </div>
      <div class="font-row">
        <button class="f-btn" onclick="fs(-0.12)" title="ØªØµØºÙŠØ±">-</button>
        <button class="f-btn" onclick="fsr()" title="Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·" style="font-size:10px;">â†º</button>
        <button class="f-btn" onclick="fs(0.12)" title="ØªÙƒØ¨ÙŠØ±">+</button>
      </div>
      <div class="theme-pill">
        <button class="th-opt on" id="thLight" onclick="setTheme('light')" title="Ù†Ù‡Ø§Ø±ÙŠ"><i class="fas fa-sun"></i></button>
        <button class="th-opt"    id="thSepia" onclick="setTheme('sepia')" title="Ø³ÙŠØ¨ÙŠØ§"><i class="fas fa-coffee"></i></button>
        <button class="th-opt"    id="thDark"  onclick="setTheme('dark')"  title="Ù„ÙŠÙ„ÙŠ"><i class="fas fa-moon"></i></button>
      </div>
      <button class="ico-btn" onclick="enterRead()" title="ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©"><i class="fas fa-expand"></i></button>
      <button class="ico-btn" onclick="openNotif()" title="Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…">
        <i class="fas fa-bell"></i><div class="badge" id="notifDot"></div>
      </button>
      <button class="ico-btn" onclick="doInstall()" id="installHdrBtn" style="display:none;" title="ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"><i class="fas fa-download"></i></button>
    </div>
  </div>
</header>

<!-- NAV -->
<nav class="nav">
  <div class="nav-in">
    <button class="tab" onclick="showTab('search')" id="tab-search"><i class="fas fa-search"></i> Ø¨Ø­Ø« Ø¹Ù† Ø¢ÙŠØ©</button>
    <button class="tab on"  onclick="showTab('pages')"  id="tab-pages"><i class="fas fa-book-open"></i> ØªØµÙØ­ Ø§Ù„Ù…ØµØ­Ù</button>
  </div>
</nav>

<main class="main">

  <!-- Install Banner -->
  <div class="install-ban" id="installBan">
    <div style="font-size:26px;">ğŸ“²</div>
    <div class="install-txt" style="flex:1;"><strong>Ø«Ø¨Ù‘Øª ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø¢Ù†</strong><span>Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª</span></div>
    <button class="install-go" onclick="doInstall()">ØªØ«Ø¨ÙŠØª</button>
    <button class="install-x" onclick="dismissInstall()"><i class="fas fa-times"></i></button>
  </div>

  <!-- SEARCH PANEL -->
  <div id="search-panel" class="panel">
    <!-- Ayah of the Day -->
    <div class="aod">
      <div class="aod-hdr">
        <div class="aod-badge"><i class="fas fa-star"></i> Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</div>
        <div style="font-size:.79rem;color:rgba(255,255,255,.48);" id="aodDate"></div>
      </div>
      <div class="aod-text" id="aodText">
        <span style="opacity:.5;font-family:'Tajawal',sans-serif;font-size:1rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
      </div>
      <div class="aod-ref" id="aodRef"></div>
      <div class="aod-acts">
        <button class="aod-btn" onclick="listenAod()" style="background:var(--gold);color:#0d2b18;"><i class="fas fa-play"></i> Ø§Ø³ØªÙ…Ø¹</button>
        <button class="aod-btn" onclick="goAod()" style="background:rgba(255,255,255,.09);color:var(--gold-l);border:1px solid rgba(201,168,76,.28);"><i class="fas fa-external-link-alt"></i> Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø¢ÙŠØ©</button>
        <button class="aod-btn" onclick="shareAod()" style="background:rgba(255,255,255,.06);color:rgba(255,255,255,.55);border:1px solid rgba(255,255,255,.1);"><i class="fas fa-share-alt"></i> Ø´Ø§Ø±Ùƒ</button>
      </div>
    </div>

    <!-- Search Card -->
    <div class="card" style="padding:26px;margin-bottom:18px;">
      <h2 style="font-size:1.2rem;font-weight:700;color:var(--heading);margin-bottom:4px;"><i class="fas fa-search" style="margin-left:7px;"></i>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¢ÙŠØ©</h2>
      <p style="color:var(--muted);font-size:.83rem;margin-bottom:20px;">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ù„Ø¢ÙŠØ© Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ§Ù„ØªÙØ³ÙŠØ±</p>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(185px,1fr));gap:13px;margin-bottom:14px;">
        <div><label class="lbl"><i class="fas fa-book-open" style="color:#2d6a4f;margin-left:4px;"></i>Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©</label>
          <select id="surahSelect" class="inp"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --</option></select>
          <div id="surahInfo" style="display:none;margin-top:4px;font-size:.76rem;color:var(--muted);"></div></div>
        <div><label class="lbl"><i class="fas fa-hashtag" style="color:#3b82f6;margin-left:4px;"></i>Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©</label>
          <input type="number" id="ayahInSurah" class="inp" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©" min="1">
          <div id="ayahRange" style="display:none;margin-top:4px;font-size:.76rem;color:var(--muted);">1 - <span id="maxAyah">?</span></div></div>
        <div><label class="lbl"><i class="fas fa-user-circle" style="color:#8b5cf6;margin-left:4px;"></i>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦</label>
          <select id="reciterSelect" class="inp"></select></div>
      </div>
      <div style="margin-bottom:16px;">
        <label class="lbl"><i class="fas fa-globe" style="color:#f59e0b;margin-left:4px;"></i>Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø¹Ø§Ù…</label>
        <div style="display:flex;gap:8px;">
          <input type="number" id="globalAyah" class="inp" placeholder="1-6236" min="1" max="6236" style="flex:1;">
          <button onclick="searchByGlobalAyah()" style="padding:10px 16px;background:rgba(245,158,11,.12);color:#92400e;border:1px solid rgba(245,158,11,.28);border-radius:10px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;">Ø¨Ø­Ø«</button>
        </div>
      </div>
      <div style="margin-bottom:20px;">
        <label class="lbl"><i class="fas fa-bolt" style="color:#ef4444;margin-left:4px;"></i>Ø¢ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</label>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(125px,1fr));gap:8px;">
          <button onclick="loadQuickAyah(1,1)"   style="padding:10px;background:rgba(34,197,94,.07);color:#166534;border:1px solid rgba(34,197,94,.18);border-radius:10px;cursor:pointer;font-family:'Tajawal',sans-serif;font-weight:600;font-size:.83rem;">Ø§Ù„ÙØ§ØªØ­Ø©<br><span style="opacity:.6;font-size:.73rem;">Ù¡:Ù¡</span></button>
          <button onclick="loadQuickAyah(2,255)" style="padding:10px;background:rgba(59,130,246,.07);color:#1e40af;border:1px solid rgba(59,130,246,.18);border-radius:10px;cursor:pointer;font-family:'Tajawal',sans-serif;font-weight:600;font-size:.83rem;">Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ<br><span style="opacity:.6;font-size:.73rem;">Ø§Ù„Ø¨Ù‚Ø±Ø©:Ù¢Ù¥Ù¥</span></button>
          <button onclick="loadQuickAyah(24,35)" style="padding:10px;background:rgba(139,92,246,.07);color:#5b21b6;border:1px solid rgba(139,92,246,.18);border-radius:10px;cursor:pointer;font-family:'Tajawal',sans-serif;font-weight:600;font-size:.83rem;">Ø¢ÙŠØ© Ø§Ù„Ù†ÙˆØ±<br><span style="opacity:.6;font-size:.73rem;">Ø§Ù„Ù†ÙˆØ±:Ù£Ù¥</span></button>
          <button onclick="loadQuickAyah(9,128)" style="padding:10px;background:rgba(245,158,11,.07);color:#92400e;border:1px solid rgba(245,158,11,.18);border-radius:10px;cursor:pointer;font-family:'Tajawal',sans-serif;font-weight:600;font-size:.83rem;">Ø¢ÙŠØ© Ø§Ù„ØªÙˆØ¨Ø©<br><span style="opacity:.6;font-size:.73rem;">Ø§Ù„ØªÙˆØ¨Ø©:Ù¡Ù¢Ù¨</span></button>
        </div>
      </div>
      <div style="text-align:center;">
        <button id="searchBtn" onclick="fetchAyahBySurah()" class="btn-p">
          <i class="fas fa-play-circle"></i> Ø§Ø¨Ø­Ø« ÙˆØ´Ø§Ù‡Ø¯ Ø§Ù„Ø¢ÙŠØ©
          <span id="searchSpinner" style="display:none;"><i class="fas fa-spinner fa-spin"></i></span>
        </button>
      </div>
      <div id="errorMsg" style="display:none;margin-top:13px;padding:12px 15px;background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.22);border-radius:10px;color:#dc2626;font-size:.88rem;">
        <i class="fas fa-exclamation-triangle" style="margin-left:6px;"></i><span id="errorText"></span>
        <p id="errorDetails" style="font-size:.76rem;opacity:.75;margin-top:3px;"></p>
      </div>
    </div>

    <!-- Results -->
    <div id="resultsSection" style="display:none;">
      <div id="ayahCard" class="card" style="padding:22px;margin-bottom:15px;"><div id="ayahDisplay"></div></div>

      <!-- Audio Card -->
      <div id="audioCard" class="card" style="padding:18px;margin-bottom:15px;background:linear-gradient(135deg,rgba(245,158,11,.05),rgba(245,158,11,.01));">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:9px;margin-bottom:13px;">
          <div style="display:flex;align-items:center;gap:9px;">
            <div style="width:38px;height:38px;background:rgba(245,158,11,.12);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#92400e;font-size:15px;"><i class="fas fa-headphones"></i></div>
            <div><div style="font-weight:700;color:var(--txt);font-size:.95rem;" id="reciterName">ØªÙ„Ø§ÙˆØ© Ø§Ù„Ø´ÙŠØ®</div><div style="font-size:.75rem;color:var(--muted);">Ø§Ø³ØªÙ…Ø¹ Ø¨ØªÙ„Ø§ÙˆØ© ÙˆØ§Ø¶Ø­Ø©</div></div>
          </div>
          <div style="display:flex;gap:6px;">
            <button onclick="playAudio()" style="padding:7px 13px;background:#f59e0b;color:#fff;border:none;border-radius:8px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;font-size:.82rem;"><i class="fas fa-play" style="margin-left:3px;"></i>ØªØ´ØºÙŠÙ„</button>
            <button onclick="pauseAudio()" style="padding:7px 13px;background:var(--surface2);color:var(--txt2);border:1px solid var(--border);border-radius:8px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;font-size:.82rem;"><i class="fas fa-pause" style="margin-left:3px;"></i>Ø¥ÙŠÙ‚Ø§Ù</button>
          </div>
        </div>
        <div id="audioDisplay"></div>
      </div>

      <!-- Tajweed + Translation + Tafseer -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:14px;margin-bottom:14px;">

        <!-- Tajweed Card (full width) -->
        <div id="tajweedCard" class="card" style="padding:18px;display:none;background:linear-gradient(135deg,rgba(201,168,76,.06),rgba(201,168,76,.01));grid-column:1/-1;"></div>

        <!-- Translation -->
        <div id="translationCard" class="card" style="padding:18px;background:linear-gradient(135deg,rgba(59,130,246,.04),rgba(59,130,246,.01));">
          <div style="display:flex;align-items:center;gap:9px;margin-bottom:12px;">
            <div style="width:36px;height:36px;background:rgba(59,130,246,.1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#1e40af;font-size:14px;"><i class="fas fa-language"></i></div>
            <div><div style="font-weight:700;color:var(--txt);font-size:.92rem;">Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</div></div>
          </div><div id="translationDisplay"></div>
        </div>

        <!-- Tafseer -->
        <div id="tafseerCard" class="card" style="padding:18px;background:linear-gradient(135deg,rgba(139,92,246,.04),rgba(139,92,246,.01));">
          <div style="display:flex;align-items:center;gap:9px;margin-bottom:12px;">
            <div style="width:36px;height:36px;background:rgba(139,92,246,.1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#5b21b6;font-size:14px;"><i class="fas fa-book-open"></i></div>
            <div><div style="font-weight:700;color:var(--txt);font-size:.92rem;">Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±</div></div>
          </div><div id="tafseerDisplay"></div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;">
        <div id="shareCard" class="card" style="padding:14px;display:none;">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:7px;">
            <div style="display:flex;align-items:center;gap:8px;"><div style="width:34px;height:34px;background:rgba(34,197,94,.1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#166534;font-size:13px;"><i class="fas fa-share-alt"></i></div><div style="font-weight:700;color:var(--txt);font-size:.88rem;">Ø´Ø§Ø±Ùƒ Ø§Ù„Ø¢ÙŠØ©</div></div>
            <div style="display:flex;gap:6px;">
              <button onclick="shareAyah()" style="padding:6px 12px;background:#22c55e;color:#fff;border:none;border-radius:7px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;font-size:.8rem;"><i class="fas fa-share" style="margin-left:3px;"></i>Ù…Ø´Ø§Ø±ÙƒØ©</button>
              <button onclick="copyAyah()" style="padding:6px 12px;background:var(--surface2);color:var(--txt2);border:1px solid var(--border);border-radius:7px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;font-size:.8rem;"><i class="fas fa-copy" style="margin-left:3px;"></i>Ù†Ø³Ø®</button>
            </div>
          </div>
        </div>
        <div id="navigationCard" class="card" style="padding:14px;display:none;">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:7px;">
            <div style="display:flex;align-items:center;gap:8px;"><div style="width:34px;height:34px;background:rgba(59,130,246,.1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#1e40af;font-size:13px;"><i class="fas fa-arrows-alt-h"></i></div><div style="font-weight:700;color:var(--txt);font-size:.88rem;">ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø¢ÙŠØ§Øª</div></div>
            <div style="display:flex;gap:6px;">
              <button onclick="previousAyah()" style="padding:6px 12px;background:#3b82f6;color:#fff;border:none;border-radius:7px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;font-size:.8rem;"><i class="fas fa-arrow-right" style="margin-left:3px;"></i>Ø³Ø§Ø¨Ù‚Ø©</button>
              <button onclick="nextAyah()" style="padding:6px 12px;background:#3b82f6;color:#fff;border:none;border-radius:7px;font-family:'Tajawal',sans-serif;font-weight:600;cursor:pointer;font-size:.8rem;">ØªØ§Ù„ÙŠØ©<i class="fas fa-arrow-left" style="margin-right:3px;"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="loadingState" style="display:none;text-align:center;padding:48px 20px;" class="card">
      <div class="spinner" style="margin:0 auto 12px;"></div>
      <p style="color:var(--txt);font-weight:700;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ©</p>
      <p style="color:var(--muted);font-size:.84rem;margin-top:5px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
    </div>
  </div>

  <!-- PAGES PANEL -->
  <div id="pages-panel" class="panel on">
    <div style="display:flex;flex-direction:column;align-items:center;gap:14px;">
      <div class="pg-ctrl">
        <button class="pnav" id="firstPg" onclick="goToPage(1)"><i class="fas fa-angle-double-right"></i></button>
        <button class="pnav" id="prevPg"  onclick="changePage(-1)"><i class="fas fa-angle-right"></i></button>
        <div class="pg-grp"><label>ØµÙØ­Ø©</label><input type="number" class="pg-inp" id="pageInput" value="1" min="1" max="604" onchange="goToPage(parseInt(this.value))"><span class="pg-tot">/ 604</span></div>
        <button class="pnav" id="nextPg"  onclick="changePage(1)"><i class="fas fa-angle-left"></i></button>
        <button class="pnav" id="lastPg"  onclick="goToPage(604)"><i class="fas fa-angle-double-left"></i></button>
        <div style="width:1px;height:26px;background:var(--border);"></div>
        <select class="ctrl-sel" id="pageJumpSurah" onchange="jumpToSurah(this.value)"><option value="">Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø³ÙˆØ±Ø©</option></select>
        <select class="ctrl-sel" id="pageRecSel" onchange="recChanged()"></select>
        <button class="pnav" onclick="enterRead()" title="ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©"><i class="fas fa-expand"></i></button>
      </div>
      <div style="width:100%;max-width:880px;">
        <div class="mushaf" id="mushafPage">
          <div class="pg-load"><div class="spinner"></div><div class="load-txt">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...</div></div>
        </div>
      </div>
      <div style="display:flex;gap:9px;align-items:center;padding-bottom:80px;">
        <button class="pnav" onclick="changePage(-1)"><i class="fas fa-angle-right"></i></button>
        <span style="color:var(--muted);font-size:.86rem;" id="pgStatus">ØµÙØ­Ø© 1 Ù…Ù† 604</span>
        <button class="pnav" onclick="changePage(1)"><i class="fas fa-angle-left"></i></button>
      </div>
    </div>
  </div>
</main>

<!-- AYAH POPUP -->
<div class="popup" id="popupEl">
  <button class="popup-close" onclick="closePopup()"><i class="fas fa-times"></i></button>
  <div class="pop-ref"  id="popRef"></div>
  <div class="pop-txt"  id="popTxt"></div>
  <div class="pop-taf"  id="popTaf" style="display:none;"></div>
  <div class="pop-acts">
    <button class="pop-btn" onclick="playPopup()" style="background:#1a472a;color:#fff;"><i class="fas fa-play"></i> Ø§Ø³ØªÙ…Ø¹</button>
    <button class="pop-btn" id="tafBtn" onclick="loadTafPopup()" style="background:rgba(139,92,246,.09);color:#5b21b6;border:1px solid rgba(139,92,246,.18);"><i class="fas fa-book-open"></i> ØªÙØ³ÙŠØ±</button>
    <button class="pop-btn" onclick="copyPopup()" style="background:var(--surface2);color:var(--txt2);border:1px solid var(--border);"><i class="fas fa-copy"></i> Ù†Ø³Ø®</button>
  </div>
</div>

<!-- MINI PLAYER -->
<div class="bar" id="barEl">
  <div class="b-info"><div class="b-ref" id="bRef">-</div><div class="b-rec" id="bRec">-</div></div>
  <div class="prog-area">
    <div class="prog-bar" id="progBar" onclick="seekAud(event)"><div class="prog-fill" id="progFill"></div></div>
    <div class="t-row"><span id="curT">0:00</span><span id="durT">0:00</span></div>
  </div>
  <div class="b-ctrl">
    <button class="ab" onclick="skipAud(-5)"><i class="fas fa-backward"></i></button>
    <button class="ab main" id="ppBtn" onclick="togglePlay()"><i class="fas fa-play"></i></button>
    <button class="ab" onclick="skipAud(5)"><i class="fas fa-forward"></i></button>
  </div>
  <button class="close-bar" onclick="closeBar()"><i class="fas fa-times"></i></button>
  <audio id="mainAud" style="display:none;"></audio>
</div>

<!-- NOTIFICATION PANEL -->
<div class="notif-ov" id="notifOv" onclick="closeNotif()"></div>
<div class="notif-panel" id="notifPnl">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
    <div class="notif-title"><i class="fas fa-bell" style="color:var(--gold);"></i> Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</div>
    <button onclick="closeNotif()" style="background:none;border:none;color:var(--muted);font-size:17px;cursor:pointer;"><i class="fas fa-times"></i></button>
  </div>
  <p style="font-size:.83rem;color:var(--muted);margin-bottom:13px;line-height:1.6;">Ø§Ø®ØªØ± ÙˆÙ‚Øª Ø§Ø³ØªÙ„Ø§Ù… Ø¥Ø´Ø¹Ø§Ø± ÙŠÙˆÙ…ÙŠ Ø¨Ø¢ÙŠØ© Ù…Ù† ÙƒØªØ§Ø¨ Ø§Ù„Ù„Ù‡.</p>
  <div style="font-size:.8rem;font-weight:700;color:var(--txt2);margin-bottom:8px;">ÙˆÙ‚Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
  <div class="time-grid">
    <button class="t-opt on" data-t="07:00" onclick="selTime(this)">ğŸŒ… Ø§Ù„ØµØ¨Ø§Ø­<br><span style="font-size:.73rem;opacity:.7;">7:00 Øµ</span></button>
    <button class="t-opt"    data-t="12:00" onclick="selTime(this)">â˜€ï¸ Ø§Ù„Ø¸Ù‡Ø±<br><span style="font-size:.73rem;opacity:.7;">12:00 Ù…</span></button>
    <button class="t-opt"    data-t="16:00" onclick="selTime(this)">ğŸŒ¤ Ø§Ù„Ø¹ØµØ±<br><span style="font-size:.73rem;opacity:.7;">4:00 Ù…</span></button>
    <button class="t-opt"    data-t="18:30" onclick="selTime(this)">ğŸŒ† Ø§Ù„Ù…ØºØ±Ø¨<br><span style="font-size:.73rem;opacity:.7;">6:30 Ù…</span></button>
    <button class="t-opt"    data-t="20:00" onclick="selTime(this)">ğŸŒ™ Ø§Ù„Ø¹Ø´Ø§Ø¡<br><span style="font-size:.73rem;opacity:.7;">8:00 Ù…</span></button>
    <button class="t-opt"    data-t="custom" onclick="selTime(this)">âš™ï¸ Ù…Ø®ØµØµ<br><span style="font-size:.73rem;opacity:.7;">Ø§Ø®ØªØ± ÙˆÙ‚ØªØ§Ù‹</span></button>
  </div>
  <div id="custTWrap" style="display:none;margin-bottom:10px;"><input type="time" id="custT" class="inp" style="font-size:1rem;"></div>
  <button class="notif-en-btn" onclick="enableNotif()"><i class="fas fa-bell"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
  <div class="notif-st" id="notifSt"></div>
  <div style="margin-top:12px;padding-top:11px;border-top:1px solid var(--border);">
    <button onclick="testNotif()" style="width:100%;padding:9px;background:var(--surface2);color:var(--muted);border:1px solid var(--border);border-radius:9px;font-family:'Tajawal',sans-serif;font-size:.8rem;cursor:pointer;"><i class="fas fa-paper-plane" style="margin-left:5px;"></i>Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø¢Ù†</button>
  </div>
  <div style="margin-top:8px;">
    <button onclick="disableNotif()" style="width:100%;padding:9px;background:rgba(239,68,68,.07);color:#dc2626;border:1px solid rgba(239,68,68,.22);border-radius:9px;font-family:'Tajawal',sans-serif;font-size:.8rem;cursor:pointer;"><i class="fas fa-bell-slash" style="margin-left:5px;"></i>Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toastEl"><i id="toastIco" class="fas fa-check-circle" style="color:#22c55e;"></i><span id="toastTxt"></span></div>

<script src="config.js"></script>
<script src="main.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  THEME & FONT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setTheme(t){
  document.body.setAttribute('data-theme',t);
  localStorage.setItem('q-theme',t);
  // Reset all
  ['Light','Sepia','Dark'].forEach(x=>{
    const el=document.getElementById('th'+x);
    if(el) el.classList.remove('on');
  });
  // Activate chosen
  const map={light:'Light',sepia:'Sepia',dark:'Dark'};
  const el=document.getElementById('th'+(map[t]||'Light'));
  if(el) el.classList.add('on');
  const c={light:'#1a472a',sepia:'#5c3a1e',dark:'#0a160d'};
  document.getElementById('themeColorMeta').content=c[t]||'#1a472a';
}
function loadTheme(){setTheme(localStorage.getItem('q-theme')||'light');}

let curFs=1.65;
function fs(d){curFs=Math.max(1.1,Math.min(2.6,curFs+d));applyFs();localStorage.setItem('q-fs',curFs);}
function fsr(){curFs=1.65;applyFs();localStorage.setItem('q-fs',curFs);}
function applyFs(){
  document.documentElement.style.setProperty('--fs',curFs+'rem');
  const lh=Math.max(2.4,4.2-curFs*0.58);
  document.documentElement.style.setProperty('--lh',lh);
}
function loadFs(){curFs=parseFloat(localStorage.getItem('q-fs'))||1.65;applyFs();}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  READING MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enterRead(){document.body.classList.add('read');showTab('pages');}
function exitRead(){document.body.classList.remove('read');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PWA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let dip=null;
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();dip=e;
  document.getElementById('installBan').classList.add('on');
  document.getElementById('installHdrBtn').style.display='flex';
});
window.addEventListener('appinstalled',()=>{
  dip=null;document.getElementById('installBan').classList.remove('on');
  document.getElementById('installHdrBtn').style.display='none';
  showToast('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚! ğŸ‰','success');
});
async function doInstall(){
  if(!dip){showToast('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨Ù‘Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…','info');return;}
  dip.prompt();const{outcome}=await dip.userChoice;dip=null;
  if(outcome==='accepted')showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ«Ø¨ÙŠØª...','success');
}
function dismissInstall(){document.getElementById('installBan').classList.remove('on');localStorage.setItem('inst-dis','1');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SERVICE WORKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function regSW(){
  if(!('serviceWorker' in navigator))return;
  try{const r=await navigator.serviceWorker.register('./sw.js');console.log('SW registered',r.scope);}
  catch(e){console.warn('SW not available - ok in dev mode');}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NOTIFICATIONS - Ù…ÙØµÙ„ÙØ­
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selNotifTime='07:00';
let notifTimer=null;

function openNotif(){
  document.getElementById('notifPnl').classList.add('on');
  document.getElementById('notifOv').classList.add('on');
  // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØ¹Ù‘Ù„Ø©
  if(localStorage.getItem('q-notif')==='1' && Notification.permission==='granted'){
    const t=localStorage.getItem('q-notif-t')||'07:00';
    const st=document.getElementById('notifSt');
    st.innerHTML=`âœ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© ${t}`;
    st.className='notif-st ok';
  }
}
function closeNotif(){
  document.getElementById('notifPnl').classList.remove('on');
  document.getElementById('notifOv').classList.remove('on');
}
function selTime(btn){
  document.querySelectorAll('.t-opt').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  selNotifTime=btn.dataset.t;
  document.getElementById('custTWrap').style.display=(selNotifTime==='custom')?'block':'none';
}

async function enableNotif(){
  const st=document.getElementById('notifSt');
  st.className='notif-st';st.textContent='';

  // ÙØ­Øµ Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  if(!('Notification' in window)){
    st.textContent='âš ï¸ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
    st.className='notif-st no';
    return;
  }

  let permission=Notification.permission;

  // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙÙ…Ù†Ø­ Ø¨Ø¹Ø¯
  if(permission==='default'){
    try{permission=await Notification.requestPermission();}
    catch(e){permission='denied';}
  }

  if(permission==='granted'){
    let t=selNotifTime;
    if(t==='custom'){
      t=document.getElementById('custT').value;
      if(!t){st.textContent='âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ù…Ø®ØµØµ';st.className='notif-st no';return;}
    }
    localStorage.setItem('q-notif','1');
    localStorage.setItem('q-notif-t',t);
    document.getElementById('notifDot').classList.add('on');
    st.innerHTML=`âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© ${t} ÙŠÙˆÙ…ÙŠØ§Ù‹`;
    st.className='notif-st ok';
    scheduleNotif(t);
    showToast('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ğŸ””','success');
  } else if(permission==='denied'){
    st.innerHTML='âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†.<br><small>Ø§ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ â† Ø§Ù„Ø®ØµÙˆØµÙŠØ© â† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ£Ø°Ù† Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹</small>';
    st.className='notif-st no';
  }
}

function disableNotif(){
  localStorage.removeItem('q-notif');
  localStorage.removeItem('q-notif-t');
  if(notifTimer){clearTimeout(notifTimer);notifTimer=null;}
  document.getElementById('notifDot').classList.remove('on');
  const st=document.getElementById('notifSt');
  st.textContent='ğŸ”• ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
  st.className='notif-st no';
  showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª','info');
}

function scheduleNotif(time){
  if(notifTimer){clearTimeout(notifTimer);notifTimer=null;}
  const[h,m]=time.split(':').map(Number);
  const now=new Date();
  const target=new Date();
  target.setHours(h,m,0,0);
  if(target<=now)target.setDate(target.getDate()+1);
  const delay=target-now;
  console.log(`Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‚Ø§Ø¯Ù… Ø®Ù„Ø§Ù„: ${Math.round(delay/60000)} Ø¯Ù‚ÙŠÙ‚Ø©`);
  notifTimer=setTimeout(async()=>{
    await fireNotif();
    scheduleNotif(time); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
  },delay);
}

async function fireNotif(){
  if(Notification.permission!=='granted')return;
  try{
    const seed=new Date().toDateString();
    let hash=0;
    for(const c of seed){hash=((hash<<5)-hash)+c.charCodeAt(0);hash|=0;}
    const n=Math.abs(hash%6236)+1;
    const res=await fetch(`https://api.alquran.cloud/v1/ayah/${n}`);
    const data=await res.json();
    if(!data.data)return;
    const a=data.data;
    const body=`${a.text.substring(0,120)}...\n${a.surah.name} â€” Ø§Ù„Ø¢ÙŠØ© ${a.numberInSurah}`;
    const opts={body,dir:'rtl',lang:'ar',tag:'aod',renotify:true,vibrate:[250,100,250]};
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Service Worker Ø£ÙˆÙ„Ø§Ù‹
    if('serviceWorker' in navigator){
      try{
        const reg=await navigator.serviceWorker.getRegistration();
        if(reg){await reg.showNotification('Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ğŸ“–',opts);return;}
      }catch(e){/* fallback */}
    }
    // Fallback: Ø¥Ø´Ø¹Ø§Ø± Ù…Ø¨Ø§Ø´Ø±
    new Notification('Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ğŸ“–',{body,dir:'rtl',lang:'ar',tag:'aod'});
  }catch(e){console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:',e);}
}

async function testNotif(){
  const st=document.getElementById('notifSt');
  let permission=Notification.permission;
  if(permission==='default'){
    try{permission=await Notification.requestPermission();}catch(e){permission='denied';}
  }
  if(permission!=='granted'){
    st.innerHTML='âŒ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹';
    st.className='notif-st no';
    return;
  }
  try{
    const n=Math.floor(Math.random()*6236)+1;
    const res=await fetch(`https://api.alquran.cloud/v1/ayah/${n}`);
    const data=await res.json();
    if(!data.data){showToast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ©','error');return;}
    const a=data.data;
    const body=`${a.text.substring(0,130)}...\n${a.surah.name} â€” Ø§Ù„Ø¢ÙŠØ© ${a.numberInSurah}`;
    const opts={body,dir:'rtl',lang:'ar',tag:'aod-test',renotify:true,vibrate:[200,100,200]};
    let sent=false;
    if('serviceWorker' in navigator){
      try{
        const reg=await navigator.serviceWorker.getRegistration();
        if(reg){await reg.showNotification('Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ğŸ“– (ØªØ¬Ø±ÙŠØ¨ÙŠ)',opts);sent=true;}
      }catch(e){/* fallback */}
    }
    if(!sent) new Notification('Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ğŸ“– (ØªØ¬Ø±ÙŠØ¨ÙŠ)',{body,dir:'rtl',lang:'ar'});
    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ âœ…','success');
    st.textContent='âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±';
    st.className='notif-st ok';
  }catch(e){
    showToast('ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±','error');
    st.textContent='âŒ ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±';
    st.className='notif-st no';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AYAH OF THE DAY - Ù…ÙØµÙ„ÙØ­
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let aodData=null;
// pgRec ÙŠØªÙ… ØªØ¹Ø±ÙŠÙÙ‡ Ù‡Ù†Ø§ Ù„ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ø§Ù‹ Ù„Ù„ØµÙØ­ØªÙŠÙ†
let pgRec='minshawi';

async function loadAod(){
  document.getElementById('aodDate').textContent=
    new Date().toLocaleDateString('ar-EG',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  try{
    const seed=new Date().toDateString();
    let hash=0;
    for(const c of seed){hash=((hash<<5)-hash)+c.charCodeAt(0);hash|=0;}
    const n=Math.abs(hash%6236)+1;
    const res=await fetch(`https://api.alquran.cloud/v1/ayah/${n}`);
    const data=await res.json();
    if(!data.data)throw new Error('no data');
    aodData=data.data;
    document.getElementById('aodText').textContent=aodData.text;
    document.getElementById('aodRef').textContent=
      `${aodData.surah.name} â€” Ø§Ù„Ø¢ÙŠØ© ${aodData.numberInSurah} â€¢ Ø§Ù„Ø¬Ø²Ø¡ ${aodData.juz}`;
  }catch(e){
    document.getElementById('aodText').innerHTML=
      '<span style="opacity:.5;font-family:\'Tajawal\',sans-serif;font-size:1rem;">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</span>';
  }
}

function listenAod(){
  if(!aodData)return;
  const r=QuranConfig.reciters[pgRec];
  const s=String(aodData.surah.number).padStart(3,'0');
  const av=String(aodData.numberInSurah).padStart(3,'0');
  document.getElementById('bRef').textContent=`${aodData.surah.name} â€¢ Ø§Ù„Ø¢ÙŠØ© ${aodData.numberInSurah}`;
  document.getElementById('bRec').textContent=r.name;
  const audio=document.getElementById('mainAud');
  audio.src=r.sources[0](s,av);
  audio.play().catch(e=>console.warn('ØªØ¹Ø°Ø± Ø§Ù„ØªØ´ØºÙŠÙ„:',e));
  document.getElementById('barEl').classList.add('on');
}

// âœ… Ø¥ØµÙ„Ø§Ø­ goAod: ÙŠÙ†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ main.js Ùˆ surahsList
function goAod(){
  if(!aodData)return;
  const sn=aodData.surah.number;
  const an=aodData.numberInSurah;
  // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† loadQuickAyah Ù…ØªØ§Ø­
  if(typeof window.loadQuickAyah==='function'){
    window.loadQuickAyah(sn, an);
  } else {
    // fallback: Ø§Ù†ØªÙ‚Ù„ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„
    const wait=setInterval(()=>{
      if(typeof window.loadQuickAyah==='function'){
        clearInterval(wait);
        window.loadQuickAyah(sn, an);
      }
    },200);
  }
}

function shareAod(){
  if(!aodData)return;
  const txt=`${aodData.text}\n\n${aodData.surah.name} â€” Ø§Ù„Ø¢ÙŠØ© ${aodData.numberInSurah}\n\n#Ø¢ÙŠØ©_Ø§Ù„ÙŠÙˆÙ… #Ù‚Ø±Ø¢Ù†_ÙƒØ±ÙŠÙ…`;
  if(navigator.share) navigator.share({title:'Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…',text:txt});
  else navigator.clipboard.writeText(txt).then(()=>showToast('ØªÙ… Ù†Ø³Ø® Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…','success'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PAGE VIEWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curPg=1, popData=null, pgCache={};
const SP={1:1,2:2,3:50,4:77,5:106,6:128,7:151,8:177,9:187,10:208,11:221,12:235,13:249,14:255,15:262,16:267,17:282,18:293,19:305,20:312,21:322,22:333,23:342,24:350,25:359,26:367,27:377,28:385,29:396,30:404,31:411,32:415,33:418,34:428,35:434,36:440,37:446,38:453,39:458,40:467,41:477,42:483,43:489,44:496,45:499,46:502,47:507,48:511,49:515,50:518,51:520,52:523,53:526,54:528,55:531,56:534,57:537,58:542,59:545,60:549,61:551,62:553,63:554,64:556,65:558,66:560,67:562,68:564,69:566,70:568,71:570,72:572,73:574,74:575,75:577,76:578,77:580,78:582,79:583,80:585,81:586,82:587,83:587,84:589,85:590,86:591,87:591,88:592,89:593,90:594,91:595,92:595,93:596,94:596,95:597,96:597,97:598,98:598,99:599,100:599,101:600,102:600,103:601,104:601,105:601,106:602,107:602,108:602,109:602,110:603,111:603,112:603,113:604,114:604};

function initPV(){
  const chk=setInterval(()=>{
    if(typeof surahsList!=='undefined' && surahsList.length>0){
      clearInterval(chk);
      // populate jump surah
      const jsel=document.getElementById('pageJumpSurah');
      surahsList.forEach(s=>{
        const o=document.createElement('option');
        o.value=s.number;
        o.textContent=`${s.number}. ${s.name}`;
        jsel.appendChild(o);
      });
      // populate reciter select
      const rsel=document.getElementById('pageRecSel');
      rsel.innerHTML='';
      Object.values(QuranConfig.reciters).forEach(r=>{
        const o=document.createElement('option');
        o.value=r.id;
        o.textContent=r.name;
        rsel.appendChild(o);
      });
      rsel.value=pgRec;
      loadPage(1);
    }
  },300);

  // Audio events
  const aud=document.getElementById('mainAud');
  aud.addEventListener('timeupdate',()=>{
    if(!aud.duration)return;
    document.getElementById('progFill').style.width=(aud.currentTime/aud.duration*100)+'%';
    document.getElementById('curT').textContent=fmt(aud.currentTime);
  });
  aud.addEventListener('loadedmetadata',()=>{document.getElementById('durT').textContent=fmt(aud.duration);});
  aud.addEventListener('ended',()=>{document.getElementById('ppBtn').innerHTML='<i class="fas fa-play"></i>';});
  aud.addEventListener('play',()=>{document.getElementById('ppBtn').innerHTML='<i class="fas fa-pause"></i>';});
  aud.addEventListener('pause',()=>{document.getElementById('ppBtn').innerHTML='<i class="fas fa-play"></i>';});

  // Keyboard shortcuts
  document.addEventListener('keydown',e=>{
    if(['INPUT','SELECT','TEXTAREA'].includes(document.activeElement.tagName))return;
    if(e.key==='ArrowLeft')changePage(1);
    if(e.key==='ArrowRight')changePage(-1);
    if(e.key==='Escape'){closePopup();closeBar();}
    if(e.key===' '){e.preventDefault();togglePlay();}
  });
}

function recChanged(){
  pgRec=document.getElementById('pageRecSel').value;
  showToast('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø§Ø±Ø¦','success');
}

async function loadPage(n){
  curPg=Math.max(1,Math.min(604,n));
  document.getElementById('pageInput').value=curPg;
  document.getElementById('pgStatus').textContent=`ØµÙØ­Ø© ${curPg} Ù…Ù† 604`;
  ['prevPg','firstPg'].forEach(id=>document.getElementById(id).disabled=curPg<=1);
  ['nextPg','lastPg'].forEach(id=>document.getElementById(id).disabled=curPg>=604);
  const el=document.getElementById('mushafPage');
  if(pgCache[curPg]){renderPage(pgCache[curPg]);return;}
  el.innerHTML=`<div class="pg-load"><div class="spinner"></div><div class="load-txt">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ${curPg}...</div></div>`;
  try{
    const res=await fetch(`https://api.alquran.cloud/v1/page/${curPg}/quran-uthmani`);
    const data=await res.json();
    if(!data.data?.ayahs)throw new Error('no data');
    pgCache[curPg]=data.data;
    renderPage(data.data);
  }catch(e){
    el.innerHTML=`<div class="pg-load"><i class="fas fa-exclamation-triangle" style="font-size:1.8rem;color:#ef4444;"></i><div style="color:#ef4444;margin-top:8px;">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</div><button onclick="loadPage(${curPg})" style="padding:8px 20px;background:#1a472a;color:#fff;border:none;border-radius:8px;cursor:pointer;font-family:'Tajawal',sans-serif;margin-top:8px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button></div>`;
  }
}

function renderPage(pd){
  const ayahs=pd.ayahs;
  if(!ayahs?.length)return;
  const el=document.getElementById('mushafPage');
  const surahs=[...new Map(ayahs.map(a=>[a.surah.number,a.surah])).values()];
  const first=surahs[0];
  const last=surahs[surahs.length-1];
  let html=`<div class="pg-hdr"><span>${first.name}</span><span>Ø§Ù„Ø¬Ø²Ø¡ ${ayahs[0].juz}</span><span>${curPg}</span></div>`;
  const groups=[];
  ayahs.forEach(a=>{
    if(!groups.length||groups[groups.length-1].sn!==a.surah.number)
      groups.push({sn:a.surah.number,surah:a.surah,ayahs:[]});
    groups[groups.length-1].ayahs.push(a);
  });
  let content='';
  groups.forEach(g=>{
    const isNew=g.ayahs[0].numberInSurah===1;
    if(isNew){
      const info=surahsList.find(s=>s.number===g.sn);
      const type=info?(info.revelationType==='Meccan'?'Ù…ÙƒÙŠØ©':'Ù…Ø¯Ù†ÙŠØ©'):'';
      content+=`<div class="surah-sep"><div class="sep-name">${g.surah.name}</div><div class="sep-info">${type} â€¢ ${info?.numberOfAyahs||''} Ø¢ÙŠØ©</div></div>`;
    }
    g.ayahs.forEach(a=>{
      const txt=a.text.replace(/'/g,"&apos;").replace(/"/g,"&quot;");
      content+=`<span class="av" data-g="${a.number}" data-s="${a.surah.number}" data-a="${a.numberInSurah}" data-n="${a.surah.name}" data-t="${encodeURIComponent(a.text)}" onclick="onAyah(this)">${a.text}<span class="an">ï´¿${toAr(a.numberInSurah)}ï´¾</span></span> `;
    });
  });
  html+=`<div class="ayahs">${content}</div>`;
  html+=`<div class="pg-ftr"><span>ØµÙØ­Ø© ${curPg} â€¢ ${first.name}${surahs.length>1?' â€” '+last.name:''}</span></div>`;
  el.innerHTML=html;
  el.style.opacity='0';
  requestAnimationFrame(()=>{el.style.transition='opacity 0.38s';el.style.opacity='1';});
}

function onAyah(el){
  document.querySelectorAll('.av.pl').forEach(e=>e.classList.remove('pl'));
  el.classList.add('pl');
  popData={global:+el.dataset.g,surah:+el.dataset.s,ayah:+el.dataset.a,name:el.dataset.n,text:decodeURIComponent(el.dataset.t)};
  document.getElementById('popRef').textContent=`${el.dataset.n} â€¢ Ø§Ù„Ø¢ÙŠØ© ${el.dataset.a}`;
  document.getElementById('popTxt').textContent=decodeURIComponent(el.dataset.t);
  document.getElementById('popTaf').style.display='none';
  document.getElementById('tafBtn').style.display='';
  document.getElementById('tafBtn').innerHTML='<i class="fas fa-book-open"></i> ØªÙØ³ÙŠØ±';
  document.getElementById('popupEl').classList.add('on');
}
function closePopup(){document.getElementById('popupEl').classList.remove('on');}

async function loadTafPopup(){
  if(!popData)return;
  const btn=document.getElementById('tafBtn');
  btn.innerHTML='<i class="fas fa-spinner fa-spin"></i>';
  btn.disabled=true;
  try{
    const res=await fetch(`https://api.alquran.cloud/v1/ayah/${popData.global}/ar.muyassar`);
    const data=await res.json();
    if(data.data?.text){
      document.getElementById('popTaf').textContent=data.data.text;
      document.getElementById('popTaf').style.display='block';
      btn.style.display='none';
    }
  }catch(e){btn.innerHTML='<i class="fas fa-times"></i> Ø®Ø·Ø£';}
  finally{btn.disabled=false;}
}

async function playPopup(){
  if(!popData)return;
  closePopup();
  const r=QuranConfig.reciters[pgRec];
  const s=String(popData.surah).padStart(3,'0');
  const a=String(popData.ayah).padStart(3,'0');
  document.getElementById('bRef').textContent=`${popData.name} â€¢ Ø§Ù„Ø¢ÙŠØ© ${popData.ayah}`;
  document.getElementById('bRec').textContent=r.name;
  document.getElementById('barEl').classList.add('on');
  for(const fn of r.sources){
    const url=fn(s,a);
    try{
      const chk=await fetch(url,{method:'HEAD'});
      if(chk.ok){
        document.getElementById('mainAud').src=url;
        document.getElementById('mainAud').play().catch(()=>{});
        return;
      }
    }catch(e){continue;}
  }
  showToast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ø§ÙˆØ©','error');
}

function copyPopup(){
  if(!popData)return;
  navigator.clipboard.writeText(`${popData.text}\n\n${popData.name} â€” Ø§Ù„Ø¢ÙŠØ© ${popData.ayah}`)
    .then(()=>showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¢ÙŠØ©','success'));
}

function togglePlay(){const a=document.getElementById('mainAud');if(!a.src)return;a.paused?a.play():a.pause();}
function skipAud(s){const a=document.getElementById('mainAud');a.currentTime=Math.max(0,a.currentTime+s);}
function seekAud(e){
  const a=document.getElementById('mainAud');
  if(!a.duration)return;
  const bar=document.getElementById('progBar');
  const r=bar.getBoundingClientRect();
  a.currentTime=((r.right-e.clientX)/r.width)*a.duration;
}
function closeBar(){
  const a=document.getElementById('mainAud');
  a.pause();a.src='';
  document.getElementById('barEl').classList.remove('on');
  document.querySelectorAll('.av.pl').forEach(e=>e.classList.remove('pl'));
}
function changePage(d){const n=curPg+d;if(n>=1&&n<=604)goToPage(n);}
function goToPage(n){loadPage(Math.max(1,Math.min(604,parseInt(n)||1)));window.scrollTo({top:0,behavior:'smooth'});}
function jumpToSurah(n){if(!n)return;goToPage(SP[+n]||1);document.getElementById('pageJumpSurah').value='';}
function fmt(s){if(isNaN(s))return'0:00';return`${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;}
function toAr(n){return String(n).split('').map(d=>'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[+d]??d).join('');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(t){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('on'));
  document.getElementById(t+'-panel').classList.add('on');
  document.getElementById('tab-'+t).classList.add('on');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tt=null;
function showToast(msg,type='info'){
  const ic={success:'fa-check-circle',error:'fa-exclamation-circle',warning:'fa-exclamation-triangle',info:'fa-info-circle'};
  const cl={success:'#22c55e',error:'#ef4444',warning:'#f59e0b',info:'#3b82f6'};
  document.getElementById('toastTxt').textContent=msg;
  document.getElementById('toastIco').className=`fas ${ic[type]||ic.info}`;
  document.getElementById('toastIco').style.color=cl[type]||cl.info;
  document.getElementById('toastEl').classList.add('on');
  if(tt)clearTimeout(tt);
  tt=setTimeout(()=>document.getElementById('toastEl').classList.remove('on'),2700);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded',()=>{
  loadTheme();
  loadFs();
  regSW();
  initPV();
  loadAod();
  // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  if(localStorage.getItem('q-notif')==='1' && Notification.permission==='granted'){
    document.getElementById('notifDot').classList.add('on');
    scheduleNotif(localStorage.getItem('q-notif-t')||'07:00');
  }
  if(localStorage.getItem('inst-dis'))
    document.getElementById('installBan').classList.remove('on');
});

// Expose globally
window.showTab=showTab;
window.showToast=showToast;
window.loadQuickAyah=(...a)=>{
  showTab('search');
  if(typeof window.__loadQuickAyah==='function'){
    window.__loadQuickAyah(...a);
  } else {
    const w=setInterval(()=>{
      if(typeof window.__loadQuickAyah==='function'){
        clearInterval(w);window.__loadQuickAyah(...a);
      }
    },200);
  }
};
</script>
</body>
</html>
